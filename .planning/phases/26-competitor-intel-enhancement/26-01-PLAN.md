---
phase: 26-competitor-intel-enhancement
plan: 01
type: execute
---

<objective>
Enhance competitor intelligence with structured pricing tiers, offer details, and messaging themes extracted from ad creatives and research.

Purpose: Transform generic competitor snapshots into actionable competitive intel with real pricing, offers, and positioning patterns.
Output: Enhanced CompetitorSnapshot with pricingTiers, mainOffer, and adMessagingThemes fields populated from ad analysis + research.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior phase context:**
@.planning/phases/24-competitor-ad-research/24-01-SUMMARY.md
@.planning/phases/25-creative-carousel-ui/25-01-SUMMARY.md

**Relevant source files:**
@src/lib/strategic-blueprint/output-types.ts
@src/lib/strategic-blueprint/pipeline/competitor-research.ts
@src/lib/ad-library/types.ts
@src/components/strategic-research/section-content.tsx

**Prior decisions affecting this phase:**
- Phase 24: AdCreative type has headline, body fields available for text analysis
- Phase 24: 10 ads per platform per competitor provides sufficient sample for pattern extraction
- Phase 25: AdCreativeCarousel displays in competitor cards after strengths/weaknesses grid

**Current CompetitorSnapshot fields:**
- name, positioning, offer, price, funnels, adPlatforms, strengths, weaknesses, adCreatives[]

**Enhancement goals:**
- pricingTiers: Array of { tier, price, features } extracted from research + ad mentions
- mainOffer: Structured { headline, valueProposition, cta } from ad patterns
- adMessagingThemes: Array of recurring themes/angles found across ads
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add enhanced intel fields to CompetitorSnapshot type</name>
  <files>src/lib/strategic-blueprint/output-types.ts</files>
  <action>
Add three new optional fields to the CompetitorSnapshot interface:

1. `pricingTiers?: PricingTier[]` - Array of pricing tiers with:
   - tier: string (e.g., "Starter", "Pro", "Enterprise")
   - price: string (e.g., "$99/mo", "$299/mo", "Custom")
   - features?: string[] (key features at this tier)

2. `mainOffer?: CompetitorOffer` - Structured offer with:
   - headline: string (primary value proposition from ads)
   - valueProposition: string (what they promise)
   - cta: string (common call-to-action pattern)

3. `adMessagingThemes?: string[]` - Array of 3-5 recurring messaging themes extracted from ad copy

Create the PricingTier and CompetitorOffer interfaces above CompetitorSnapshot.

Keep existing fields unchanged - these are additive enhancements.
  </action>
  <verify>npm run build succeeds with no TypeScript errors</verify>
  <done>PricingTier, CompetitorOffer interfaces exist; CompetitorSnapshot has pricingTiers, mainOffer, adMessagingThemes optional fields</done>
</task>

<task type="auto">
  <name>Task 2: Extract enhanced intel from ads and research</name>
  <files>src/lib/strategic-blueprint/pipeline/competitor-research.ts</files>
  <action>
Enhance the competitor research pipeline to populate the new fields:

1. Create `analyzeAdMessaging(ads: AdCreative[]): AdMessagingAnalysis` helper that:
   - Extracts all headline and body text from ads
   - Identifies recurring words/phrases (>2 occurrences)
   - Returns { themes: string[], commonCTAs: string[], priceMentions: string[] }

2. Create `extractPricingFromText(text: string): PricingTier[]` helper that:
   - Uses regex to find price patterns ($X/mo, $X/year, $X one-time)
   - Associates with tier names if mentioned nearby
   - Returns array of extracted tiers (may be empty)

3. Update the Perplexity system prompt to request structured pricing:
   - Add to REQUIRED JSON STRUCTURE:
     ```
     "pricingTiers": [{ "tier": "string", "price": "string", "features": ["array"] }],
     "mainOffer": { "headline": "string", "valueProposition": "string", "cta": "string" }
     ```
   - Add instruction: "Search competitor pricing pages for actual pricing tiers"

4. After fetching ads, call analyzeAdMessaging() for each competitor:
   - Merge ad-extracted themes into competitor data
   - Merge any price mentions with Perplexity pricing data
   - Set adMessagingThemes field

5. Update parseCompetitorAnalysisJSON() to handle new fields:
   - Parse pricingTiers with defensive defaults (empty array)
   - Parse mainOffer with defensive defaults (undefined if missing)
   - Ensure backward compatibility - old responses without fields still work

Keep the 60s timeout - pricing research may need extra time.
  </action>
  <verify>Run the app locally and trigger a blueprint generation. Check console logs for "[Competitor Research]" entries showing pricing/theme extraction. Verify no runtime errors.</verify>
  <done>analyzeAdMessaging and extractPricingFromText helpers exist; Perplexity prompt requests pricing tiers; parseCompetitorAnalysisJSON handles new fields; competitors have pricingTiers/mainOffer/adMessagingThemes populated</done>
</task>

<task type="auto">
  <name>Task 3: Display enhanced intel in competitor cards</name>
  <files>src/components/strategic-research/section-content.tsx</files>
  <action>
Update CompetitorAnalysisContent to display the new fields:

1. Add Pricing Tiers section after the Offer/Price grid:
   - Only render if comp.pricingTiers has items
   - Display as horizontal badges or small table: "Starter: $99/mo | Pro: $299/mo | Enterprise: Custom"
   - Use muted styling to not overwhelm the card

2. Add Main Offer section if comp.mainOffer exists:
   - Display headline in semi-bold
   - Show valueProposition as italic text below
   - Show CTA as a small badge

3. Add Messaging Themes section if comp.adMessagingThemes has items:
   - Display after strengths/weaknesses grid, before AdCreativeCarousel
   - Render as horizontal flex of small outline badges
   - Label: "Ad Themes:" followed by badges

4. Make all new sections editable when isEditing=true:
   - pricingTiers: EditableList for tier strings (formatted as "Tier: $Price")
   - mainOffer fields: EditableText for headline, valueProposition, cta
   - adMessagingThemes: EditableList

Use existing SubSection, Badge, and editable components for consistency.
  </action>
  <verify>npm run build succeeds; npm run dev and navigate to /generate, complete onboarding to see competitor cards with new sections (if data exists)</verify>
  <done>Competitor cards show pricing tiers, main offer, and messaging themes when data is available; sections are editable in edit mode; no visual regressions</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes (or only pre-existing warnings)
- [ ] New TypeScript interfaces are properly exported
- [ ] Competitor research still completes successfully (backward compatible)
- [ ] UI renders enhanced intel when available, gracefully hides when not
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- CompetitorSnapshot type has pricingTiers, mainOffer, adMessagingThemes fields
- Perplexity prompt requests structured pricing data
- Ad text is analyzed for messaging themes
- Competitor cards display enhanced intel with edit support
- Backward compatible with existing blueprints (new fields optional)
</success_criteria>

<output>
After completion, create `.planning/phases/26-competitor-intel-enhancement/26-01-SUMMARY.md`:

# Phase 26 Plan 01: Competitor Intel Enhancement Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for next milestone
</output>
