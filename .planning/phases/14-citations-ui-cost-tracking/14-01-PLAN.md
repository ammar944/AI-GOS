---
phase: 14-citations-ui-cost-tracking
plan: 01
type: execute
---

<objective>
Display inline citations and sources section in review UI with per-model cost tracking.

Purpose: Surface research citations to users for credibility and enable cost visibility per section/model.
Output: CitationBadge, SourcesList, CostSummary components integrated into StrategicResearchReview.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior decisions affecting this phase:**
- Phase 10-01: Citation type with url, title, date, snippet fields
- Phase 10-02: sectionCitations stored in metadata.sectionCitations (keyed by section name)
- Phase 10-02: ResearchCostSummary with byModel breakdown (calls, cost, citations per model)

**Available data:**
- `strategicBlueprint.metadata.sectionCitations` - Record<string, Citation[]> with citations per section
- `strategicBlueprint.metadata.totalCost` - Total generation cost
- `strategicBlueprint.metadata.modelsUsed` - Array of model names used

**UI patterns to follow:**
@src/components/strategic-research/section-card.tsx - Existing section card structure
@src/components/strategic-research/review.tsx - StrategicResearchReview component
@src/lib/strategic-blueprint/output-types.ts - Citation type definition
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CitationBadge and SourcesList components</name>
  <files>src/components/strategic-research/citations.tsx</files>
  <action>
Create a new file with two components:

1. **CitationBadge** - Small badge showing citation count for a section
   - Props: count: number
   - Display: Link2 icon + count (e.g., "5 sources")
   - Style: Badge variant="outline" with muted styling
   - Only render if count > 0

2. **SourcesList** - Collapsible list of citations/sources
   - Props: citations: Citation[], sectionLabel: string
   - Display: Collapsible panel with citation links
   - Each citation shows:
     - Title (linked to URL) - truncate to 60 chars
     - Domain extracted from URL
     - Date if available
     - Snippet if available (first 150 chars)
   - Use Collapsible from @radix-ui/react-collapsible (already in project via shadcn)
   - Style: matches existing section content styling (muted bg, rounded corners)

Follow existing component patterns:
- "use client" directive
- Props interface exported
- Named exports
- Lucide icons (Link2, ExternalLink, ChevronDown)
  </action>
  <verify>
- File exists at src/components/strategic-research/citations.tsx
- TypeScript compiles: npx tsc --noEmit
- Both components exported
  </verify>
  <done>CitationBadge and SourcesList components created with proper typing and styling</done>
</task>

<task type="auto">
  <name>Task 2: Integrate citations into SectionCard</name>
  <files>src/components/strategic-research/section-card.tsx</files>
  <action>
Modify SectionCard to display citations:

1. Add new props to SectionCardProps:
   - citations?: Citation[] (optional - only sections 1-4 have citations)

2. In CardHeader, after the "Reviewed" badge:
   - Add CitationBadge showing citations.length if citations exist and length > 0

3. At bottom of CardContent (after SectionContentRenderer, before CardFooter):
   - Add SourcesList component when citations exist and length > 0
   - Only show when section is expanded

Import CitationBadge and SourcesList from "./citations"
Import Citation type from "@/lib/strategic-blueprint/output-types"
  </action>
  <verify>
- npx tsc --noEmit passes
- SectionCard accepts citations prop
- CitationBadge appears in header when citations provided
- SourcesList appears in content when expanded and citations exist
  </verify>
  <done>SectionCard displays citation count badge and expandable sources list</done>
</task>

<task type="auto">
  <name>Task 3: Wire citations through StrategicResearchReview</name>
  <files>src/components/strategic-research/review.tsx</files>
  <action>
Pass citations from blueprint metadata to each SectionCard:

1. Extract sectionCitations from strategicBlueprint.metadata.sectionCitations

2. In the SectionCard render, add citations prop:
   ```tsx
   citations={sectionCitations?.[sectionKey] || []}
   ```

3. Add CostSummary display in the Header Card:
   - After progress indicator, show total cost: "$X.XX"
   - Format: "Generation cost: $0.0123"
   - Only show if totalCost > 0

4. Import Citation type from "@/lib/strategic-blueprint/output-types"

Note: sectionCitations keys are section names like "industryMarketOverview", "competitorAnalysis" etc.
  </action>
  <verify>
- npx tsc --noEmit passes
- npm run build succeeds
- Citations prop passed to all SectionCards
- Cost displayed in header card
  </verify>
  <done>Citations flow from metadata to SectionCards, cost summary visible in header</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes without errors
- [ ] `npm run build` succeeds
- [ ] Citation badges appear on sections with citations
- [ ] SourcesList expands to show citation details
- [ ] Generation cost displays in header
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Citations visible per section when available
- Cost tracking visible in review header
- Existing review functionality unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/14-citations-ui-cost-tracking/14-01-SUMMARY.md`:

# Phase 14 Plan 1: Citations UI & Cost Tracking Summary

**[One-liner summary of what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 14 complete. v1.3 Multi-Agent Research milestone complete.
</output>
