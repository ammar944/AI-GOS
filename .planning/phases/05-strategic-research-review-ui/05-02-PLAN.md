---
phase: 05-strategic-research-review-ui
plan: 02
type: execute
---

<objective>
Create the full strategic research review UI and integrate it into the /generate page flow.

Purpose: Enable users to review their generated strategic research in a structured way before proceeding, establishing the validation gate that will be enhanced with editing (Phase 6) and approval flow (Phase 7).

Output: `StrategicResearchReview` component integrated into `/generate` page with new "review-blueprint" state.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior plan output:**
@.planning/phases/05-strategic-research-review-ui/05-01-SUMMARY.md (if exists)

**Components from Plan 05-01:**
@src/components/strategic-research/section-card.tsx
@src/components/strategic-research/section-content.tsx
@src/components/strategic-research/index.ts

**Page to modify:**
@src/app/generate/page.tsx

**Prior decisions affecting this phase:**
- Strategic research only at gate - user reviews research before media plan
- User reviews all 5 sections before proceeding

**Existing patterns:**
- Page state machine pattern in generate/page.tsx (onboarding → generating-blueprint → complete)
- Progress indicators with section badges
- Card-based layouts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StrategicResearchReview component</name>
  <files>src/components/strategic-research/review.tsx, src/components/strategic-research/index.ts</files>
  <action>
Create the main review UI component that displays all 5 strategic research sections for user review.

**Component props:**
```typescript
interface StrategicResearchReviewProps {
  strategicBlueprint: StrategicBlueprintOutput;
  onComplete: () => void; // Called when user finishes review
  onRegenerate: () => void; // Called if user wants to regenerate
}
```

**Layout structure:**

1. **Header section:**
   - Title: "Review Your Strategic Research"
   - Subtitle: "Review each section before continuing. You'll be able to edit specific details in the next step."
   - Progress indicator: "X of 5 sections reviewed"
   - Progress bar showing review completion

2. **Section cards area:**
   - Render all 5 sections using SectionCard components
   - Track expanded state for each section (allow multiple expanded)
   - Track reviewed state for each section
   - First section auto-expanded on mount

3. **Action bar (sticky at bottom or after sections):**
   - "Regenerate" button (outline variant) - calls onRegenerate
   - "Continue" button (primary, disabled until all sections reviewed) - calls onComplete
   - Helper text: "Review all sections to continue"

**State management:**
```typescript
const [expandedSections, setExpandedSections] = useState<Set<StrategicBlueprintSection>>(
  new Set(['industryMarketOverview']) // First section expanded by default
);
const [reviewedSections, setReviewedSections] = useState<Set<StrategicBlueprintSection>>(new Set());

const allReviewed = reviewedSections.size === 5;
```

**Behavior:**
- User can expand/collapse any section
- User marks sections as reviewed via button in each card
- Once all 5 reviewed, "Continue" button becomes enabled
- Smooth scroll to next unreviewed section when marking one as reviewed (nice UX)

**Styling:**
- Use existing Card patterns
- Match the visual style of the success banner in generate/page.tsx
- Use Badge components for progress indicators
- Progress bar using existing Progress component
  </action>
  <verify>
- File exists: src/components/strategic-research/review.tsx
- Component exports StrategicResearchReviewProps and StrategicResearchReview
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
- StrategicResearchReview component created
- All 5 sections rendered with SectionCard
- Review tracking state works
- Continue button disabled until all reviewed
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate review mode into /generate page</name>
  <files>src/app/generate/page.tsx</files>
  <action>
Add a new "review-blueprint" state to the generate page flow, inserting it between blueprint generation and the complete state.

**Update PageState type:**
```typescript
type PageState =
  | "onboarding"
  | "generating-blueprint"
  | "review-blueprint"  // NEW: Review before proceeding
  | "complete"
  | "error";
```

**Flow changes:**

1. After blueprint generation succeeds (in handleOnboardingComplete):
   - Change: `setPageState("complete")` → `setPageState("review-blueprint")`

2. Add new handler for review completion:
```typescript
const handleReviewComplete = useCallback(() => {
  setPageState("complete");
}, []);
```

3. Add review-blueprint render state (before the complete state check):
```typescript
// Review Blueprint State
if (pageState === "review-blueprint" && strategicBlueprint) {
  return (
    <div className="min-h-screen bg-gradient-to-b from-background to-muted/20">
      <div className="container mx-auto px-4 py-8 md:py-12">
        {/* Stage Indicator */}
        <div className="mx-auto max-w-5xl mb-8">
          <div className="flex items-center justify-center gap-4">
            <div className="flex items-center gap-2">
              <div className="flex h-8 w-8 items-center justify-center rounded-full bg-green-500 text-white text-sm font-medium">
                <CheckCircle2 className="h-4 w-4" />
              </div>
              <span className="text-sm text-muted-foreground">Onboarding</span>
            </div>
            <ArrowRight className="h-4 w-4 text-muted-foreground" />
            <div className="flex items-center gap-2">
              <div className="flex h-8 w-8 items-center justify-center rounded-full bg-primary text-primary-foreground text-sm font-medium">
                2
              </div>
              <span className="text-sm font-medium">Review Research</span>
            </div>
            <ArrowRight className="h-4 w-4 text-muted-foreground" />
            <div className="flex items-center gap-2 opacity-50">
              <div className="flex h-8 w-8 items-center justify-center rounded-full bg-muted text-muted-foreground text-sm font-medium">
                3
              </div>
              <span className="text-sm">Complete</span>
            </div>
          </div>
        </div>

        {/* Review Component */}
        <div className="mx-auto max-w-5xl">
          <StrategicResearchReview
            strategicBlueprint={strategicBlueprint}
            onComplete={handleReviewComplete}
            onRegenerate={handleRegenerateBlueprint}
          />
        </div>
      </div>
    </div>
  );
}
```

4. Update imports at top of file:
```typescript
import { StrategicResearchReview } from "@/components/strategic-research";
```

5. Update resume logic in handleResume:
   - If saved state shows blueprint exists but not reviewed, set to "review-blueprint"
   - This ensures users resume at the review step if they left mid-review

**Important:** Keep the existing "complete" state as-is for now. Phase 7 will add the approval flow that leads to media plan generation.
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- Build succeeds: `npm run build`
- PageState includes "review-blueprint"
- Import for StrategicResearchReview added
  </verify>
  <done>
- PageState updated with review-blueprint
- Review state renders StrategicResearchReview component
- Flow goes: onboarding → generating → review-blueprint → complete
- Build passes
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Strategic Research Review UI integrated into /generate page</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:3000/generate
    3. Click "Auto-fill with Sample Data" then submit the form
    4. Wait for Strategic Blueprint generation to complete
    5. Verify: You see the new "Review Your Strategic Research" screen (not the old "Complete" screen)
    6. Test: Expand/collapse section cards
    7. Test: Click "Mark as Reviewed" on each section
    8. Verify: Progress indicator updates (1/5, 2/5, etc.)
    9. Verify: "Continue" button is disabled until all 5 sections marked as reviewed
    10. Test: Click "Continue" after all reviewed - should go to Complete screen
  </how-to-verify>
  <resume-signal>Type "approved" if the review UI works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run build` succeeds
- [ ] Review flow works end-to-end (verified by checkpoint)
- [ ] All sections display correctly
- [ ] Progress tracking works
- [ ] Continue button enables only when all reviewed
</verification>

<success_criteria>
- StrategicResearchReview component created and working
- /generate page has new review-blueprint state
- User must review all 5 sections before continuing
- UI matches existing visual patterns
- Verified working via checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/05-strategic-research-review-ui/05-02-SUMMARY.md`

# Phase 5 Plan 2: Review UI and Integration Summary

**[Substantive one-liner describing what was built]**

## Performance
- **Duration:** [time]
- **Started:** [timestamp]
- **Completed:** [timestamp]
- **Tasks:** 3 (2 auto + 1 checkpoint)
- **Files modified:** [count]

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `src/components/strategic-research/review.tsx` - Main review UI component
- `src/components/strategic-research/index.ts` - Updated exports
- `src/app/generate/page.tsx` - Added review-blueprint state

## Decisions Made
[Any decisions made during implementation]

## Deviations from Plan
[Document any deviations per deviation rules]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Phase Readiness
- Review UI complete, ready for Phase 6 (Inline Edit Capability)
- Structure in place for adding edit buttons to section cards
- State management ready to track user edits
</output>
