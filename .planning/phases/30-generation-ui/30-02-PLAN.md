---
phase: 30-generation-ui
plan: 02
type: execute
domain: ui
---

<objective>
Add streaming generation display showing sections appearing in real-time as they complete.

Purpose: Transform the generation experience from waiting for full completion to watching sections appear progressively, providing immediate feedback and perceived performance improvement.
Output: SSE streaming from API, client-side stream handling, animated section preview display.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/docs/AI-GOS-DESIGN-SYSTEM.md

**Prior plan in this phase:**
@.planning/phases/30-generation-ui/30-01-SUMMARY.md

**Prior decisions affecting this phase:**
- Phase 18: Chat streaming uses SSE with Content-Type text/event-stream
- Phase 18: Client checks Content-Type to determine stream vs JSON handling

**Relevant source files:**
@src/app/generate/page.tsx
@src/app/api/strategic-blueprint/generate/route.ts
@src/lib/strategic-blueprint/output-types.ts
@src/components/pipeline/pipeline.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SSE streaming to generate API</name>
  <files>src/app/api/strategic-blueprint/generate/route.ts</files>
  <action>
Modify the generate API route to support Server-Sent Events streaming:

1. Add optional `stream` query parameter or header check

2. When streaming enabled, return ReadableStream with SSE format:
   - Content-Type: text/event-stream
   - Cache-Control: no-cache
   - Connection: keep-alive

3. SSE event types to emit:
   - `section-start`: { section: string } - when starting a section
   - `section-complete`: { section: string, data: object } - when section done
   - `progress`: { percentage: number, message: string } - progress updates
   - `metadata`: { totalTime: number, totalCost: number } - cost tracking
   - `done`: { success: true, strategicBlueprint: object } - final result
   - `error`: { message: string, code?: string } - on failure

4. Use TextEncoder to encode SSE messages:
   ```typescript
   const encoder = new TextEncoder();
   const stream = new ReadableStream({
     async start(controller) {
       // Emit events as sections complete
       controller.enqueue(encoder.encode(`event: section-complete\ndata: ${JSON.stringify(data)}\n\n`));
     }
   });
   ```

5. Wrap existing section generation loop to emit events between sections

6. Keep non-streaming path working (backward compatibility) when stream param not set
  </action>
  <verify>curl -N "http://localhost:3000/api/strategic-blueprint/generate?stream=true" with POST body shows SSE events</verify>
  <done>API streams section-complete events as each section finishes</done>
</task>

<task type="auto">
  <name>Task 2: Add client-side stream handling</name>
  <files>src/app/generate/page.tsx</files>
  <action>
Replace the current fetch call with streaming EventSource handling:

1. Create useStreamingGeneration custom hook or inline logic:
   - Uses fetch with stream=true parameter
   - Reads response body as ReadableStream
   - Parses SSE events using TextDecoder and event parsing

2. SSE parsing logic:
   ```typescript
   const reader = response.body.getReader();
   const decoder = new TextDecoder();
   let buffer = '';

   while (true) {
     const { done, value } = await reader.read();
     if (done) break;

     buffer += decoder.decode(value, { stream: true });
     const events = buffer.split('\n\n');
     buffer = events.pop() || '';

     for (const event of events) {
       // Parse event: and data: lines
       // Call appropriate handler
     }
   }
   ```

3. State management for streaming:
   - streamingSections: Map of section name to data (accumulates as they complete)
   - currentStreamingSection: string | null
   - streamError: string | null

4. Event handlers:
   - section-start: Set currentStreamingSection, update Pipeline stage
   - section-complete: Add to streamingSections map, update stats
   - progress: Update blueprintProgress state
   - metadata: Update blueprintMeta state
   - done: Set strategicBlueprint, transition to review-blueprint
   - error: Set error state, transition to error

5. Update elapsed time and cost stats in real-time from metadata events
  </action>
  <verify>TypeScript compiles without errors: npx tsc --noEmit</verify>
  <done>Client receives and processes SSE events, updating state in real-time</done>
</task>

<task type="auto">
  <name>Task 3: Create StreamingSectionPreview component</name>
  <files>src/components/pipeline/streaming-section-preview.tsx</files>
  <action>
Create component to display sections as they stream in:

1. Props interface:
   - sections: Map<string, object> (completed sections)
   - currentSection: string | null (section being generated)
   - className?: string

2. Layout:
   - Vertical stack of section cards
   - Each card shows section name and brief preview
   - Use GradientBorder wrapper for the container

3. Section card styling:
   - Completed sections: solid border, success indicator, collapsed preview
   - Current section: animated gradient border, pulse indicator, "Generating..." text
   - Use Framer Motion AnimatePresence for enter/exit animations

4. Card content:
   - Section title (from STRATEGIC_BLUEPRINT_SECTION_LABELS)
   - For completed: First 100 chars of stringified data or key metric
   - For current: Animated loading dots

5. Animation specs:
   - Entry: fadeUp with stagger (100ms between sections)
   - Current section: gradient border animation
   - Completion: brief scale pulse (1 -> 1.02 -> 1)

6. Add export to src/components/pipeline/index.ts
  </action>
  <verify>TypeScript compiles without errors: npx tsc --noEmit</verify>
  <done>StreamingSectionPreview renders completed and in-progress sections with animations</done>
</task>

<task type="auto">
  <name>Task 4: Integrate streaming preview into generation UI</name>
  <files>src/app/generate/page.tsx</files>
  <action>
Add StreamingSectionPreview to the generating-blueprint state:

1. Import StreamingSectionPreview from @/components/pipeline

2. Add to generating state layout (below GenerationStats):
   - Container with max-height and overflow-y-auto for scrolling
   - StreamingSectionPreview with streamingSections and currentStreamingSection

3. Layout structure:
   ```
   GradientBorder
   ├── Header (title, subtitle)
   ├── Pipeline (stage progress)
   ├── GenerationStats (4 stat cards)
   └── StreamingSectionPreview (scrollable section list)
   ```

4. Responsive behavior:
   - Full width on mobile
   - Max-height: 300px with scroll on desktop
   - Smooth scroll to bottom as new sections appear

5. Auto-scroll behavior:
   - useRef for container
   - useEffect to scroll to bottom when new section completes
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>Generation UI shows sections appearing in real-time with scroll</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Streaming generation UI with Pipeline, stats, and section preview</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/generate
    3. Fill out onboarding form (use Auto-fill with Sample Data)
    4. Click Generate Blueprint
    5. Verify:
       - Pipeline shows stage progression with animated pulse on current
       - Stats update in real-time (time, cost, sections count)
       - Sections appear one by one in the preview area
       - Each section entry animates in smoothly
       - Current section shows loading indicator
       - Completed sections show success state
    6. Wait for completion - should transition to review page
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes type checking
- [ ] API streams SSE events correctly
- [ ] Client parses and handles all event types
- [ ] Sections appear progressively in UI
- [ ] Error states handled gracefully
- [ ] Non-streaming path still works (backward compat)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Generation feels responsive with real-time feedback
- No regressions to existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/30-generation-ui/30-02-SUMMARY.md`

# Phase 30 Plan 02: Streaming Generation Display Summary

**[Substantive one-liner - what shipped]**

## Performance
- **Duration:** X min
- **Tasks:** 5
- **Files created/modified:** 4

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Phase 30 complete, ready for Phase 31 (Output Display)
</output>
