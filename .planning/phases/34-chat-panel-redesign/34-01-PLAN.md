---
phase: 34-chat-panel-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/layout/split-chat-layout.tsx
autonomous: true

must_haves:
  truths:
    - "Desktop shows 30/70 split with resizable divider"
    - "User can drag divider between 20% and 40%"
    - "Mobile shows vertical stack (blueprint above, chat below)"
    - "Resize handle visible with visual feedback on hover/drag"
  artifacts:
    - path: "src/components/layout/split-chat-layout.tsx"
      provides: "Resizable split layout container"
      min_lines: 80
    - path: "package.json"
      provides: "react-resizable-panels dependency"
      contains: "react-resizable-panels"
  key_links:
    - from: "src/components/layout/split-chat-layout.tsx"
      to: "react-resizable-panels"
      via: "Group/Panel/Separator imports"
      pattern: "import.*from.*react-resizable-panels"
---

<objective>
Create the SplitChatLayout component using react-resizable-panels v4 that provides a resizable 30/70 split layout for chat sidebar and blueprint content.

Purpose: Enable permanent side-by-side chat during blueprint review with user-adjustable panel widths.
Output: SplitChatLayout component ready for integration with chat sidebar and blueprint content.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-chat-panel-redesign/34-CONTEXT.md
@.planning/phases/34-chat-panel-redesign/34-RESEARCH.md
@src/lib/motion.ts
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-resizable-panels</name>
  <files>package.json</files>
  <action>
    Install react-resizable-panels v4:
    ```bash
    npm install react-resizable-panels@^4.4.1
    ```

    This library provides the Group/Panel/Separator components needed for the split layout.
    It handles all the complex resize mechanics including constraints, touch support, and accessibility.
  </action>
  <verify>
    Run `npm ls react-resizable-panels` to confirm version ^4.4.1 is installed.
    Check package.json contains the dependency.
  </verify>
  <done>react-resizable-panels v4.x installed and listed in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create SplitChatLayout component</name>
  <files>src/components/layout/split-chat-layout.tsx</files>
  <action>
    Create a new component at `src/components/layout/split-chat-layout.tsx`:

    **Requirements from CONTEXT.md:**
    - Resizable with drag handle
    - Fixed range: 20% to 40% for chat panel
    - Blueprint panel fills remaining space (60% to 80%)
    - Default: 30% chat / 70% blueprint
    - No persistence (resets to 30% on page load)
    - Touch-friendly resize handle

    **Implementation:**
    ```tsx
    "use client";

    import { Group, Panel, Separator } from "react-resizable-panels";
    import { cn } from "@/lib/utils";

    interface SplitChatLayoutProps {
      chatContent: React.ReactNode;
      blueprintContent: React.ReactNode;
      className?: string;
    }

    export function SplitChatLayout({
      chatContent,
      blueprintContent,
      className,
    }: SplitChatLayoutProps) {
      return (
        <div className={cn("h-full", className)}>
          {/* Desktop: side-by-side with resize */}
          <div className="hidden lg:block h-full">
            <Group orientation="horizontal" className="h-full">
              {/* Chat sidebar: 30% default, 20-40% range */}
              <Panel
                defaultSize="30%"
                minSize="20%"
                maxSize="40%"
              >
                <div
                  className="h-full flex flex-col"
                  style={{ background: 'var(--bg-surface)' }}
                >
                  {chatContent}
                </div>
              </Panel>

              {/* Resize handle with visual indicator */}
              <Separator className="w-px relative group cursor-col-resize">
                {/* Visual handle bar */}
                <div
                  className="absolute inset-y-0 -left-1.5 -right-1.5 w-4 flex items-center justify-center"
                >
                  <div
                    className="w-1 h-12 rounded-full transition-colors duration-150 group-hover:scale-110"
                    style={{
                      background: 'var(--border-default)',
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.background = 'var(--accent-blue)';
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.background = 'var(--border-default)';
                    }}
                  />
                </div>
              </Separator>

              {/* Blueprint content: fills remaining space */}
              <Panel minSize="60%">
                <div className="h-full overflow-y-auto">
                  {blueprintContent}
                </div>
              </Panel>
            </Group>
          </div>

          {/* Mobile: vertical stack (blueprint above, chat below) */}
          <div className="lg:hidden h-full flex flex-col">
            {/* Blueprint takes most of the space */}
            <div className="flex-1 min-h-0 overflow-y-auto">
              {blueprintContent}
            </div>

            {/* Chat panel at bottom - fixed height on mobile */}
            <div
              className="h-[45vh] flex-shrink-0 flex flex-col"
              style={{
                borderTop: '1px solid var(--border-default)',
                background: 'var(--bg-surface)',
              }}
            >
              {chatContent}
            </div>
          </div>
        </div>
      );
    }
    ```

    **Key design decisions:**
    - Uses v4 API: Group/Panel/Separator (not PanelGroup/PanelResizeHandle)
    - orientation="horizontal" (not direction)
    - String sizes ("30%") not numbers
    - Visual handle appears on hover with blue accent
    - Touch-friendly 16px hit area on separator
    - Mobile uses 45vh for chat (comfortable typing area)
    - Blueprint scrolls independently with overflow-y-auto
  </action>
  <verify>
    1. File exists at src/components/layout/split-chat-layout.tsx
    2. TypeScript compiles without errors: `npx tsc --noEmit`
    3. Component exports correctly: check for `export function SplitChatLayout`
  </verify>
  <done>
    SplitChatLayout component created with:
    - Desktop: 30/70 resizable split (20-40% range for chat)
    - Mobile: vertical stack (blueprint above, chat below at 45vh)
    - Touch-friendly resize handle with hover feedback
  </done>
</task>

<task type="auto">
  <name>Task 3: Create layout barrel export</name>
  <files>src/components/layout/index.ts</files>
  <action>
    Create barrel export file at `src/components/layout/index.ts`:

    ```ts
    export { SplitChatLayout } from './split-chat-layout';
    ```

    This enables clean imports like:
    ```ts
    import { SplitChatLayout } from '@/components/layout';
    ```
  </action>
  <verify>
    File exists and exports SplitChatLayout.
  </verify>
  <done>Barrel export created for layout components</done>
</task>

</tasks>

<verification>
1. `npm ls react-resizable-panels` shows version 4.x
2. `npx tsc --noEmit` passes without errors
3. `npm run build` completes successfully
4. Files exist:
   - src/components/layout/split-chat-layout.tsx
   - src/components/layout/index.ts
</verification>

<success_criteria>
1. react-resizable-panels v4.x installed
2. SplitChatLayout component accepts chatContent and blueprintContent props
3. Desktop layout shows side-by-side panels with resizable divider
4. Mobile layout shows vertical stack
5. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/34-chat-panel-redesign/34-01-SUMMARY.md`
</output>
