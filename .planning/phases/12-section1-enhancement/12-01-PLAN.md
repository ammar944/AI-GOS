---
phase: 12-section1-enhancement
plan: 01
type: execute
---

<objective>
Enhance Section 1 (Industry & Market Overview) with real-time research using Perplexity Deep Research.

Purpose: Replace static AI-generated market data with real-time web search results and citations for current market intelligence.
Output: IndustryMarketOverview section now uses ResearchAgent, returns CitedSectionOutput with verifiable sources.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior decisions affecting this phase:**
- Phase 11: Use `agent.research()` instead of `researchJSON()` to preserve citations
- Phase 11: 120-second timeout for deep research (multi-step web search takes longer)
- Phase 11: Defensive JSON validation with manual parsing and fallback defaults
- Phase 10: ResearchAgent wraps OpenRouterClient with citation extraction and cost tracking

**Pattern to follow (from Phase 11):**
@src/lib/strategic-blueprint/pipeline/competitor-research.ts

**Current Section 1 implementation (will be replaced):**
@src/lib/strategic-blueprint/pipeline/strategic-blueprint-generator.ts (lines 155-209 for industryMarketOverview prompt)

**Target type structure:**
@src/lib/strategic-blueprint/output-types.ts (IndustryMarketOverview, lines 12-85)

**Research infrastructure:**
@src/lib/research/agent.ts
@src/lib/research/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create industry market research function</name>
  <files>src/lib/strategic-blueprint/pipeline/industry-market-research.ts</files>
  <action>
Create a dedicated industry market research function following the competitor-research.ts pattern:

1. Create `src/lib/strategic-blueprint/pipeline/industry-market-research.ts`
2. Export `researchIndustryMarket(context: string): Promise<CitedSectionOutput<IndustryMarketOverview>>`
3. Use `createResearchAgent()` from `@/lib/research`
4. Use `MODELS.PERPLEXITY_DEEP_RESEARCH` for real-time market web search
5. Use `agent.research()` (NOT researchJSON) to preserve citations
6. Parse JSON response manually with try/catch and regex extraction (copy extractJSON/extractBalancedJSON/isValidJSON helpers from competitor-research.ts)
7. Return CitedSectionOutput with:
   - data: IndustryMarketOverview (validated with defensive defaults)
   - citations: Citation[] from research response
   - model: string
   - cost: number

The prompt should instruct Perplexity to:
- Search for real industry/market data using the provided business context
- Include actual market trends, statistics, and industry reports from web results
- Research real pain points and buying behaviors from forums, reviews, industry publications
- Return JSON matching IndustryMarketOverview schema exactly

JSON structure to request (from output-types.ts):
```json
{
  "categorySnapshot": {
    "category": "string",
    "marketMaturity": "early" | "growing" | "saturated",
    "awarenessLevel": "low" | "medium" | "high",
    "buyingBehavior": "impulsive" | "committee_driven" | "roi_based" | "mixed",
    "averageSalesCycle": "string",
    "seasonality": "string"
  },
  "marketDynamics": {
    "demandDrivers": ["string array"],
    "buyingTriggers": ["string array"],
    "barriersToPurchase": ["string array"],
    "macroRisks": {
      "regulatoryConcerns": "string",
      "marketDownturnRisks": "string",
      "industryConsolidation": "string"
    }
  },
  "painPoints": {
    "primary": ["string array"],
    "secondary": ["string array"]
  },
  "psychologicalDrivers": {
    "drivers": [{"driver": "string", "description": "string"}]
  },
  "audienceObjections": {
    "objections": [{"objection": "string", "howToAddress": "string"}]
  },
  "messagingOpportunities": {
    "opportunities": ["string array"],
    "summaryRecommendations": ["string array"]
  }
}
```

Validation function should:
- Validate required fields exist (categorySnapshot, marketDynamics, painPoints, etc.)
- Apply defensive defaults for missing/invalid nested fields
- Validate enum values (marketMaturity, awarenessLevel, buyingBehavior) with fallbacks
- Ensure arrays are arrays with fallback to empty []

Use 120000ms (2 minute) timeout for deep research, same as competitor-research.ts.
  </action>
  <verify>File exists, TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>industry-market-research.ts exports researchIndustryMarket function that returns CitedSectionOutput<IndustryMarketOverview></done>
</task>

<task type="auto">
  <name>Task 2: Update strategic blueprint generator for Section 1</name>
  <files>src/lib/strategic-blueprint/pipeline/strategic-blueprint-generator.ts</files>
  <action>
Modify the strategic blueprint generator to use the new industry market research for Section 1:

1. Import `researchIndustryMarket` from `./industry-market-research`
2. In the main loop, add special handling for `industryMarketOverview` section (similar to competitorAnalysis):
   ```typescript
   if (section === "industryMarketOverview") {
     const result = await researchIndustryMarket(context);
     partialOutput[section] = result.data;
     sectionCitations[section] = result.citations;
     totalCost += result.cost;
     modelsUsed.add(MODELS.PERPLEXITY_DEEP_RESEARCH);
     sectionTimings[section] = Date.now() - sectionStart;
     completedSections.push(section);
     updateProgress(section, `Completed ${STRATEGIC_BLUEPRINT_SECTION_LABELS[section]} (with ${result.citations.length} citations)`);
     continue;
   }
   ```
3. Keep other sections (icpAnalysisValidation, offerAnalysisViability, crossAnalysisSynthesis) using Claude Sonnet
4. Section 4 (competitorAnalysis) already uses Perplexity - no change needed there

After this change:
- Section 1 (industryMarketOverview): Perplexity Deep Research with citations
- Section 2 (icpAnalysisValidation): Claude Sonnet
- Section 3 (offerAnalysisViability): Claude Sonnet
- Section 4 (competitorAnalysis): Perplexity Deep Research with citations (already done)
- Section 5 (crossAnalysisSynthesis): Claude Sonnet
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`, build succeeds: `npm run build`</verify>
  <done>industryMarketOverview section uses Perplexity Deep Research via researchIndustryMarket(), citations tracked in metadata.sectionCitations</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes with no errors
- [ ] `npm run build` succeeds
- [ ] industry-market-research.ts exports researchIndustryMarket function
- [ ] strategic-blueprint-generator.ts uses Perplexity for Section 1
- [ ] metadata.sectionCitations includes industryMarketOverview citations after generation
- [ ] metadata.modelsUsed includes PERPLEXITY_DEEP_RESEARCH (already should from Phase 11)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Section 1 (industryMarketOverview) uses real-time Perplexity research
- Citations are extracted and stored in metadata.sectionCitations.industryMarketOverview
- Sections 2, 3, 5 continue using Claude Sonnet unchanged
- Section 4 continues using Perplexity unchanged (from Phase 11)
</success_criteria>

<output>
After completion, create `.planning/phases/12-section1-enhancement/12-01-SUMMARY.md`:

# Phase 12 Plan 1: Section 1 Industry Market Enhancement Summary

**[Substantive one-liner about what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 12 complete, ready for Phase 13 (Sections 2-3 Enhancement)
</output>
